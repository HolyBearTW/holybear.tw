name: Deploy Blog & Notify New Post to Telegram # å·¥ä½œæµç¨‹åç¨±ï¼Œæ”¹ç‚ºéƒ¨ç½²èˆ‡é€šçŸ¥

# ç•¶æœ‰æ–°çš„ push äº‹ä»¶ç™¼ç”Ÿæ™‚è§¸ç™¼æ­¤ workflow
on:
  push:
    branches:
      - main # è«‹å°‡æ­¤è™•æ”¹ç‚ºæ‚¨å„²å­˜åº«çš„ä¸»è¦åˆ†æ”¯åç¨±ï¼Œä¾‹å¦‚ master
    paths:
      - 'blog/**' # ç›£è½ 'blog/' ç›®éŒ„ä¸‹çš„ä»»ä½•æª”æ¡ˆè®Šå‹•
      - 'blog/**/*' # ç¢ºä¿æ¶µè“‹ 'blog/' å­ç›®éŒ„ä¸­çš„è®Šå‹•

jobs:
  # --- ç¬¬ä¸€å€‹ Job: è² è²¬å»ºç½®å’Œéƒ¨ç½² GitHub Pages ---
  build_and_deploy_pages:
    runs-on: ubuntu-latest
    # ã€é‡è¦ã€‘è¨­å®š environmentï¼Œé€™æ˜¯ GitHub Pages éƒ¨ç½²æ‰€éœ€çš„
    environment:
      name: github-pages
    permissions:
      contents: read
      pages: write # éƒ¨ç½² Pages éœ€è¦å¯«å…¥æ¬Šé™
      id-token: write # éƒ¨ç½² Pages éœ€è¦é€™å€‹æ¬Šé™

    outputs:
      # å°‡åµæ¸¬åˆ°çš„æ–°æª”æ¡ˆåˆ—è¡¨è¼¸å‡ºï¼Œä¾›å¾ŒçºŒ notify_new_post job ä½¿ç”¨
      new_post_files: <span class="math-inline">\{\{ steps\.get\-new\-files\.outputs\.NEW\_POST\_FILES \}\}
steps\:
\- name\: Checkout repository for build
uses\: actions/checkout@v4
with\:
fetch\-depth\: 0 \# ç²å–æ‰€æœ‰æ­·å²ç´€éŒ„ï¼Œä»¥ä¾¿ git diff èƒ½æ­£ç¢ºåˆ¤æ–·ã€Œæ–°å¢ã€çš„æª”æ¡ˆ
\- name\: Get new files in target directory \(for decision making\)
id\: get\-new\-files \# ä¿ç•™ ID ä»¥ä¾¿è¼¸å‡º
run\: \|
TARGET\_DIR\="blog/"
CURRENT\_SHA\="</span>{{ github.sha }}"
          LAST_COMMIT_SHA=<span class="math-inline">\(git rev\-parse "</span>{CURRENT_SHA}~1" 2>/dev/null || echo "")

          # å°‡åŸå§‹åµæ¸¬åˆ°çš„æª”æ¡ˆè·¯å¾‘å¯«å…¥è‡¨æ™‚æ–‡ä»¶
          temp_raw_detected_files="temp_raw_detected_files.txt"
          > "$temp_raw_detected_files" # æ¸…ç©ºæˆ–å»ºç«‹æ–‡ä»¶

          if [ -z "$LAST_COMMIT_SHA" ]; then
            # å°æ–¼å„²å­˜åº«çš„ç¬¬ä¸€æ¬¡ pushï¼Œæ‰€æœ‰ç¬¦åˆæ¢ä»¶çš„æ–‡ä»¶éƒ½è¦–ç‚ºã€Œæ–°å¢ã€
            find "$TARGET_DIR" -type f -print0 | xargs -0 -r -n 1 echo >> "<span class="math-inline">temp\_raw\_detected\_files"
else
\# æ¯”è¼ƒæœ¬æ¬¡ push å’Œä¸Šä¸€å€‹ commit ä¹‹é–“çš„å·®ç•°ï¼Œåªç¯©é¸æ–°å¢çš„æª”æ¡ˆ
git diff \-\-name\-only \-\-diff\-filter\=A "</span>{LAST_COMMIT_SHA}" "${CURRENT_SHA}" -- "$TARGET_DIR" -z | xargs -0 -r -n 1 echo >> "$temp_raw_detected_files"
          fi

          NEW_POST_FILES_FINAL="" # æœ€çµ‚è¦è¼¸å‡ºçš„ä¹¾æ·¨æª”æ¡ˆåˆ—è¡¨
          # æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½•æª”æ¡ˆè¢«åµæ¸¬åˆ°
          if [ -s "$temp_raw_detected_files" ]; then # -s æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ä¸”ä¸ç‚ºç©º
            # ä½¿ç”¨ while read è¿´åœˆå®‰å…¨åœ°è®€å–æª”æ¡ˆä¸­çš„æ¯ä¸€è¡Œ (æª”å)
            while IFS= read -r file; do
              # ã€åŠ å¼·é˜²å‘†ã€‘ç¢ºä¿æª”æ¡ˆå­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶ï¼Œä¸¦ä¸”åœ¨ç›®æ¨™ç›®éŒ„ä¸‹
              if [ -f "$file" ] && [[ "$file" == "$TARGET_DIR"* ]]; then
                # å¦‚æœ NEW_POST_FILES_FINAL ä¸ç‚ºç©ºï¼Œå‰‡å…ˆåŠ æ›è¡Œç¬¦è™Ÿ
                [ -n "<span class="math-inline">NEW\_POST\_FILES\_FINAL" \] && NEW\_POST\_FILES\_FINAL\+\=</span>'\n'
                NEW_POST_FILES_FINAL+="$file"
              else
                echo "Warning: Skipped non-existent or invalid file detected: ${file}"
              fi
            done < "$temp_raw_detected_files"
          fi

          echo "Detected NEW files in <span class="math-inline">\{TARGET\_DIR\} directory\:"
echo "</span>{NEW_POST_FILES_FINAL}" # é€™è£¡ç›´æ¥è¼¸å‡º NEW_POST_FILES_FINAL çš„å…§å®¹ï¼Œæœƒä¿ç•™æ›è¡Œ

          # å°‡çµæœè¼¸å‡ºçµ¦ä¸‹ä¸€å€‹æ­¥é©Ÿ
          echo "NEW_POST_FILES=${NEW_POST_FILES_FINAL}" >> "$GITHUB_OUTPUT"

      # --- ã€é€™è£¡æ”¾æ‚¨çš„éƒ¨è½æ ¼å»ºç½®æŒ‡ä»¤ã€‘ ---
      # é€™å€‹æ­¥é©Ÿæœƒç”Ÿæˆæ‚¨çš„éœæ…‹ç¶²ç«™æª”æ¡ˆï¼Œä¸¦æ”¾åˆ° _site æˆ– public ç›®éŒ„
      - name: Build Your Blog
        # è«‹åœ¨é€™è£¡æ›¿æ›æˆæ‚¨å¯¦éš›éƒ¨è½æ ¼çš„å»ºç½®æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼š
        # run: bundle install && bundle exec jekyll build
        # run: hugo
        # run: npm install && hexo generate
        run: |
          echo "é€™è£¡æ˜¯æ‚¨éƒ¨è½æ ¼çš„å»ºç½®æŒ‡ä»¤ã€‚å®ƒæœƒç”¢ç”Ÿéœæ…‹æª”æ¡ˆåˆ° _site æˆ– public ç›®éŒ„ã€‚"
          # ä»¥ä¸‹æ˜¯ç‚ºäº†ç¤ºç¯„è€Œæ”¾ç½®çš„æ¨¡æ“¬æŒ‡ä»¤ï¼Œè«‹å‹™å¿…æ›¿æ›ç‚ºæ‚¨çœŸå¯¦çš„å»ºç½®æŒ‡ä»¤
          mkdir -p _site 
          echo "<h1>é€™æ˜¯é¦–é </h1>" > _site/index.html
          mkdir -p _site/blog
          echo "<h1>Hello World! é€™æ˜¯ä¸€ç¯‡æ–°æ–‡ç« </h1>" > _site/blog/first-new-article.html
          # æ¨¡æ“¬æŒ‡ä»¤çµæŸï¼Œè«‹ç§»é™¤æˆ–æ›¿æ›ä¸Šæ–¹é€™äº›æ¨¡æ“¬æŒ‡ä»¤ç‚ºæ‚¨çœŸå¯¦çš„å»ºç½®æŒ‡ä»¤

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './_site' # ç¢ºä¿é€™è£¡çš„è·¯å¾‘èˆ‡æ‚¨éƒ¨è½æ ¼å¯¦éš›çš„è¼¸å‡ºç›®éŒ„ä¸€è‡´ (ä¾‹å¦‚ _site æˆ– public)

      - name: Deploy to GitHub Pages
        id: deployment # çµ¦é€™å€‹æ­¥é©Ÿä¸€å€‹ IDï¼Œæ–¹ä¾¿å¾ŒçºŒå¼•ç”¨
        uses: actions/deploy-pages@v4
        env:
          GITHUB_TOKEN: <span class="math-inline">\{\{ secrets\.GITHUB\_TOKEN \}\}
\# \-\-\- ç¬¬äºŒå€‹ Job\: ç™¼é€ Telegram é€šçŸ¥ \(åœ¨ Pages éƒ¨ç½²æˆåŠŸå¾Œ\) \-\-\-
notify\_new\_post\:
runs\-on\: ubuntu\-latest
needs\: build\_and\_deploy\_pages \# <\-\-\- ã€é—œéµã€‘é€™å€‹ Job æœƒåœ¨ build\_and\_deploy\_pages æˆåŠŸå¾Œæ‰åŸ·è¡Œ
\# åªæœ‰ç•¶ build\_and\_deploy\_pages æˆåŠŸä¸”æœ‰æ–°æª”æ¡ˆè¢«åµæ¸¬åˆ°æ™‚æ‰åŸ·è¡Œé€šçŸ¥
if\: success\(\) && needs\.build\_and\_deploy\_pages\.outputs\.new\_post\_files \!\= ''
steps\:
\- name\: Checkout repository \# é‡æ–°æª¢å‡ºï¼Œä»¥ä¾¿è®€å–æ–‡ç« å…§å®¹
uses\: actions/checkout@v4
\# é€™è£¡ä¸éœ€è¦ fetch\-depth\: 0ï¼Œå› ç‚ºæˆ‘å€‘åªè®€å–æª”æ¡ˆ
\- name\: Process and send Telegram notification \# æ­¥é©Ÿ 3\: è™•ç†æª”æ¡ˆä¸¦ç™¼é€ Telegram é€šçŸ¥
run\: \|
TELEGRAM\_BOT\_TOKEN\="</span>{{ secrets.TELEGRAM_BOT_TOKEN }}"
          TELEGRAM_CHAT_ID="<span class="math-inline">\{\{ secrets\.TELEGRAM\_CHAT\_ID \}\}"
\# å¾ä¸Šä¸€å€‹ Job ç²å–åµæ¸¬åˆ°çš„æ–°æ–‡ç« æª”æ¡ˆåˆ—è¡¨
NEW\_POST\_FILES\="</span>{{ needs.build_and_deploy_pages.outputs.new_post_files }}"
          
          # ã€é‡è¦è¨­å®šã€‘æ‚¨çš„ç¶²ç«™åŸºç¤ç¶²å€
          BASE_URL="https://holybear.me"

          # ã€åŠ å¼·é˜²å‘†ã€‘æª¢æŸ¥ NEW_POST_FILES æ˜¯å¦ç‚ºç©ºæˆ–åªåŒ…å«ç©ºç™½
          if [[ -z "<span class="math-inline">\{NEW\_POST\_FILES// /\}" \]\]; then \# ç§»é™¤æ‰€æœ‰ç©ºç™½å¾Œåˆ¤æ–·æ˜¯å¦ç‚ºç©º
echo "No valid new files detected for notification, skipping\."
exit 0 \# æå‰çµæŸï¼Œä¸ç™¼é€é€šçŸ¥
fi
\# éæ­·æ¯å€‹æ–°å¢çš„æª”æ¡ˆ
\# æ³¨æ„ï¼šç‚ºäº†å®‰å…¨è™•ç†æª”åä¸­çš„ç©ºç™½ï¼Œé€™è£¡ä½¿ç”¨ IFS å’Œ read \-r
IFS\=</span>'\n' # è¨­å®šå…§éƒ¨æ¬„ä½åˆ†éš”ç¬¦ç‚ºæ›è¡Œç¬¦ï¼Œç¢ºä¿æª”åä¸­çš„ç©ºç™½ä¸æœƒè¢«éŒ¯èª¤åœ°æ‹†åˆ†
          for file_path_raw in <span class="math-inline">\{NEW\_POST\_FILES\}; do
\# ã€é—œéµã€‘å¾¹åº•æ¸…ç† file\_path\_rawï¼Œç¢ºä¿å®ƒåªæ˜¯ä¸€å€‹ä¹¾æ·¨çš„æª”æ¡ˆè·¯å¾‘
\# é€™èƒ½è™•ç†å¯èƒ½å­˜åœ¨çš„é¡å¤–ç©ºç™½æˆ–éš±å½¢å­—å…ƒ
file\_path\="</span>(echo "<span class="math-inline">\{file\_path\_raw\}" \| xargs\)"
\# ã€åŠ å¼·é˜²å‘†ã€‘å†æ¬¡æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶ï¼Œé¿å…è™•ç†ç„¡æ•ˆè·¯å¾‘
if \[ \! \-f "</span>{file_path}" ]; then
              echo "Warning: File not found or not a regular file: ${file_path}, skipping."
              continue # è·³éç•¶å‰è¿´åœˆï¼Œè™•ç†ä¸‹ä¸€å€‹æª”æ¡ˆ
            fi

            echo "Processing file: <span class="math-inline">\{file\_path\}"
\# è®€å–æª”æ¡ˆå…§å®¹
file\_content\="</span>(cat "${file_path}")"
            
            # å¾ Markdown æª”æ¡ˆå…§å®¹ä¸­æå– title (å„ªå…ˆå¾ Front Matter æå–)
            # ã€ä¿®æ­£ã€‘awk: å°‡é›™å¼•è™Ÿçš„æ­£è¦è¡¨é”å¼å¾ `\"` æ”¹ç‚º `"`ï¼Œä¸¦ä½¿ç”¨ gsub è™•ç†å–®å¼•è™Ÿ
            TITLE="<span class="math-inline">\(echo "</span>{file_content}" | awk '
              /^---$/ { count++; if (count == 2) exit; next }
              (count == 1 && /^\s*title:/) {
                gsub(/^\s*title:\s*/, "", $0);
                gsub(/[\r\n]/, " ", $0);      # ç§»é™¤æ›è¡Œç¬¦ (CR å’Œ LF)
                gsub(/"/, "", $0);           # ç§»é™¤é›™å¼•è™Ÿ
                gsub(/\x27/, "", $0);        # ç§»é™¤å–®å¼•è™Ÿ (åå…­é€²ä½ç¢¼)
                print <span class="math-inline">0;
exit
\}
' \| xargs\)" \# å†æ¬¡ç”¨ xargs æ¸…ç†å‰å¾Œç©ºç™½åŠä»»ä½•éš±å½¢å­—å…ƒ
\# å¦‚æœ Front Matter ä¸­æ²’æœ‰ titleï¼Œå‰‡å˜—è©¦å¾ H1 æ¨™é¡Œæå–
\# ã€ä¿®æ­£ã€‘sed\: å°‡é›™å¼•è™Ÿå’Œå–®å¼•è™Ÿçš„ç§»é™¤åˆ†é–‹è™•ç†ï¼Œä¸¦ç¢ºä¿æ­£è¦è¡¨é”å¼æ­£ç¢º
if \[\[ \-z "</span>{TITLE}" ]]; then
              TITLE="<span class="math-inline">\(echo "</span>{file_content}" | grep -iE '^#\s*(.*)' | head -n 1 | sed -E 's/^#\s*(.*)/\1/' | sed -E 's/[\r\n]//g' | sed -E 's/"//g' | sed -E 's/\x27//g' | xargs)" # ç§»é™¤é›™å¼•è™Ÿå’Œå–®å¼•è™Ÿ
            fi
            # å¦‚æœä»ç„¶æ²’æœ‰æ¨™é¡Œï¼Œè¨­å®šç‚ºé è¨­å€¼
            if [[ -z "<span class="math-inline">\{TITLE\}" \]\]; then
TITLE\="ç„¡æ¨™é¡Œæ–‡ç« "
fi
\# ã€æœ€æ–°ä¿®æ­£ã€‘ä½¿ç”¨ grep å’Œ sed ä¾†æå– categoryï¼Œæ›´ç©©å®šè™•ç†å¤šç¨® YAML æ ¼å¼
\# ã€ä¿®æ­£ã€‘sed\: å°‡é›™å¼•è™Ÿå’Œå–®å¼•è™Ÿçš„ç§»é™¤åˆ†é–‹è™•ç†ï¼Œä¸¦ç¢ºä¿æ­£è¦è¡¨é”å¼æ­£ç¢º
CATEGORY\=""
CATEGORY\_RAW\="</span>(echo "<span class="math-inline">\{file\_content\}" \| grep \-A 1 \-E '^\\s\*category\:' \| grep \-E '^\\s\*\-\\s\*' \| head \-n 1 \| sed \-E 's/^\\s\*\-\\s\*\(\.\*\)/\\1/' \| sed \-E 's/\[\\r\\n\]//g' \| sed \-E 's/"//g' \| sed \-E 's/\\x27//g' \| xargs\)" \# ç§»é™¤é›™å¼•è™Ÿå’Œå–®å¼•è™Ÿ
\# åªæœ‰ç•¶ CATEGORY\_RAW åŒ…å«æœ‰æ•ˆå­—å…ƒæ™‚æ‰è³¦å€¼çµ¦ CATEGORY
if \[\[ \-n "</span>{CATEGORY_RAW}" ]]; then
              CATEGORY="<span class="math-inline">\{CATEGORY\_RAW\}"
\# å†æ¬¡æ¸…ç†ç¢ºä¿æ²’æœ‰ä»»ä½•ç‰¹æ®Šå­—å…ƒå¯èƒ½è¢«èª¤è§£
\# é€™è£¡ç”¨ tr \-cd ä¾†åªä¿ç•™ç‰¹å®šå­—å…ƒï¼Œä¸¦ç”¨ xargs æ¸…ç†å¤šé¤˜ç©ºç™½
CATEGORY\="</span>(echo "<span class="math-inline">\{CATEGORY\}" \| tr \-cd '\[\:alnum\:\] \_\-'\)" \# åªä¿ç•™å­—æ¯æ•¸å­—ã€ç©ºç™½ã€åº•ç·šã€ç ´æŠ˜è™Ÿ
CATEGORY\="</span>(echo "<span class="math-inline">\{CATEGORY\}" \| xargs\)" \# æ¸…ç†å› æ›¿æ›å¯èƒ½ç”¢ç”Ÿçš„å¤šé¤˜ç©ºç™½
fi
if \[\[ \-z "</span>{CATEGORY}" ]]; then # å¦‚æœç¬¬ä¸€å€‹æå–æ–¹å¼æ²’çµæœï¼Œå˜—è©¦ç¬¬äºŒç¨®
              CATEGORY_RAW="<span class="math-inline">\(echo "</span>{file_content}" | grep -iE '^\s*category:\s*\[.*\]' | head -n 1 | sed -E 's/^\s*category:\s*\[(.*)\].*/\1/' | cut -d',' -f1 | sed -E 's/[\r\n]//g' | sed -E 's/"//g' | sed -E 's/\x27//g' | xargs)"
              if [[ -n "<span class="math-inline">\{CATEGORY\_RAW\}" \]\]; then
CATEGORY\="</span>{CATEGORY_RAW}"
                CATEGORY="<span class="math-inline">\(echo "</span>{CATEGORY}" | tr -cd '[:alnum:] _-')"
                CATEGORY="<span class="math-inline">\(echo "</span>{CATEGORY}" | xargs)"
              fi
            fi
            if [[ -z "<span class="math-inline">\{CATEGORY\}" \]\]; then \# å¦‚æœç¬¬äºŒç¨®ä¹Ÿæ²’çµæœï¼Œå˜—è©¦ç¬¬ä¸‰ç¨®
CATEGORY\_RAW\="</span>(echo "<span class="math-inline">\{file\_content\}" \| grep \-iE '^\\s\*category\:\\s\*\[^\\\[\-\]' \| head \-n 1 \| sed \-E 's/^\\s\*category\:\\s\*\(\.\*\)/\\1/' \| sed \-E 's/\[\\r\\n\]//g' \| sed \-E 's/^"\|"//g' \| sed \-E 's/\\x27//g' \| xargs\)"
if \[\[ \-n "</span>{CATEGORY_RAW}" ]]; then
                CATEGORY="<span class="math-inline">\{CATEGORY\}"
CATEGORY\=</span>(echo "<span class="math-inline">\{CATEGORY\}" \| tr \-cd '\[\:alnum\:\] \_\-'\)
CATEGORY\=</span>(echo "<span class="math-inline">\{CATEGORY\}" \| xargs\)
fi
fi
\# é€™å€‹æœ€çµ‚çš„æ¸…ç†ä¿ç•™ï¼Œå› ç‚ºå®ƒè™•ç†çš„æ˜¯ CATEGORY è®Šæ•¸å¯èƒ½åœ¨æœ€å¾Œä»æœ‰çš„å‰å¾Œç©ºç™½æˆ–å¼•è™Ÿå•é¡Œ
\# CATEGORY\=</span>(echo "<span class="math-inline">\{CATEGORY\}" \| sed \-E 's/^\[\[\:space\:\]\]\+\|\[\[\:space\:\]\]\+</span>//g') # ç§»é™¤å‰å¾Œç©ºç™½
            # CATEGORY=<span class="math-inline">\(echo "</span>{CATEGORY}" | sed -E 's/[\x27"\/]//g') # ç§»é™¤å–®å¼•è™Ÿã€é›™å¼•è™Ÿã€æ–œç·š (é€™è£¡çš„ / å·²ç¶“æ˜¯å­—å…ƒï¼Œä¸éœ€è¦è·³è„«)

            if [[ -n "<span class="math-inline">\{CATEGORY\}" \]\]; then
TITLE\="ã€</span>{CATEGORY}ã€‘<span class="math-inline">\{TITLE\}"
fi
\# ç”¢ç”Ÿæ–‡ç« é€£çµçš„é‚è¼¯
ARTICLE\_SLUG\="</span>(echo "<span class="math-inline">\{file\_path\}" \| sed \-E 's\|^blog/\(\.\*\)\\\.md</span>|\1|')"
            ARTICLE_URL="<span class="math-inline">\{BASE\_URL\}/blog/</span>{ARTICLE_SLUG}.html" # å‡è¨­æ‚¨çš„æ–‡ç« æ˜¯ .html çµå°¾

            # çµ„è£ Telegram è¨Šæ¯
            # ã€ä¿®æ­£ã€‘ç¢ºä¿å³ä½¿ TITLE æˆ– commit message ç‚ºç©ºï¼Œè¨Šæ¯ä¹Ÿä¸æœƒå®Œå…¨ç‚ºç©º
            MESSAGE="**ğŸ“¢ New push to GitHub**\n"
            if [[ -n "<span class="math-inline">\{TITLE\}" \]\]; then
MESSAGE\+\="\*\*</span>{TITLE}**\n"
            else
                MESSAGE+="**(ç„¡æ¨™é¡Œæ–‡ç« )**\n" # å¦‚æœæ²’æœ‰æ¨™é¡Œï¼Œæä¾›ä¸€å€‹é è¨­æ¨™é¡Œ
            fi

            COMMIT_MESSAGE="<span class="math-inline">\{\{ github\.event\.head\_commit\.message \}\}"
if \[\[ \-n "</span>{COMMIT_MESSAGE}" ]]; then
                MESSAGE+="```${COMMIT_MESSAGE}```\n"
            else
                MESSAGE+="```(ç„¡æäº¤è¨Šæ¯)```\n" # å¦‚æœæ²’æœ‰æäº¤è¨Šæ¯ï¼Œæä¾›ä¸€å€‹é è¨­å€¼
            fi
            
            MESSAGE+="[>>é»æ­¤é–±è®€æ–‡ç« ](${ARTICLE_URL})\n"
            MESSAGE+="by ${{ github.event.head_commit.author.name }}"

            # ç™¼é€ Telegram è¨Šæ¯
            # ã€ä¿®æ­£ã€‘ç¢ºä¿ ENCODED_MESSAGE ä¸­çš„æ–œç·š `/` å’Œç™¾åˆ†æ¯”ç¬¦è™Ÿ `%` è¢«æ­£ç¢ºè·³è„«ï¼Œé¿å… URL ç·¨ç¢¼å•é¡Œ
            ENCODED_MESSAGE=<span class="math-inline">\(echo \-e "</span>{MESSAGE}" | sed -E 's/([_*\[\]()~`>#+\-=|{}!.\\])/\\\1/g' | sed 's/\//\\\//g' | sed 's/%/%25/g' | sed 's/ /%20/g' | sed 's/\n/%0A/g' | sed 's/\*/%2A/g' | sed 's/\[/%5B/g' | sed 's/\]/%5D/g' | sed 's/(/%28/g' | sed 's/)/%29/g' | sed 's/`/%60/g' | sed 's/{/%7B/g' | sed 's/}/%7D/g' | sed 's/~/%7E/g' | sed 's/\./%2E/g')

            curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
              -d "chat_id=<span class="math-inline">\{TELEGRAM\_CHAT\_ID\}" \\
\-d "text\=</span>{ENCODED_MESSAGE}" \
              -d "parse_mode=MarkdownV2" # ç¢ºä¿é€™è£¡ä½¿ç”¨ MarkdownV2
            echo "Telegram notification sent for ${file_path} with title: ${TITLE}"
          done
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
